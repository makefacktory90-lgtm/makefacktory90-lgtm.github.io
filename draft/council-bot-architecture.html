<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Council Bot — Архитектура</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Inter', sans-serif;
    background: #fff;
    color: #1a1a1a;
    line-height: 1.7;
    padding: 60px 40px;
    max-width: 900px;
    margin: 0 auto;
  }
  h1 {
    font-size: 2.4rem;
    font-weight: 800;
    letter-spacing: -0.03em;
    margin-bottom: 8px;
  }
  .subtitle {
    font-size: 1.1rem;
    color: #666;
    margin-bottom: 48px;
    font-weight: 400;
  }
  h2 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-top: 48px;
    margin-bottom: 16px;
    letter-spacing: -0.02em;
  }
  h3 {
    font-size: 1.15rem;
    font-weight: 600;
    margin-top: 32px;
    margin-bottom: 12px;
  }
  p { margin-bottom: 16px; }

  .schema {
    background: #f8f8f8;
    border-radius: 16px;
    padding: 32px;
    margin: 32px 0;
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 0.85rem;
    line-height: 1.8;
    white-space: pre;
    overflow-x: auto;
  }

  .prompt-block {
    background: #fafafa;
    border-left: 4px solid #1a1a1a;
    border-radius: 0 12px 12px 0;
    padding: 24px 28px;
    margin: 20px 0;
    font-size: 0.92rem;
    line-height: 1.8;
  }
  .prompt-block .label {
    font-weight: 700;
    font-size: 0.78rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #999;
    margin-bottom: 12px;
  }
  .prompt-block code {
    display: block;
    white-space: pre-wrap;
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 0.85rem;
    color: #333;
  }

  .card {
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    padding: 24px;
    margin: 16px 0;
  }
  .card h4 {
    font-size: 1rem;
    font-weight: 700;
    margin-bottom: 8px;
  }
  .card .role-tag {
    display: inline-block;
    background: #1a1a1a;
    color: #fff;
    font-size: 0.72rem;
    font-weight: 600;
    padding: 3px 10px;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    margin-bottom: 12px;
  }

  .steps {
    counter-reset: step;
    list-style: none;
    padding: 0;
  }
  .steps li {
    counter-increment: step;
    padding: 16px 0 16px 56px;
    position: relative;
    border-bottom: 1px solid #f0f0f0;
  }
  .steps li:last-child { border-bottom: none; }
  .steps li::before {
    content: counter(step);
    position: absolute;
    left: 0;
    top: 16px;
    width: 36px;
    height: 36px;
    background: #1a1a1a;
    color: #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.85rem;
  }
  .steps li strong { font-weight: 600; }

  .use-cases {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin: 24px 0;
  }
  .use-case {
    background: #f8f8f8;
    border-radius: 12px;
    padding: 20px;
  }
  .use-case h4 {
    font-size: 0.95rem;
    font-weight: 700;
    margin-bottom: 6px;
  }
  .use-case p {
    font-size: 0.85rem;
    color: #555;
    margin-bottom: 0;
  }

  .highlight {
    background: #fffbe6;
    border-radius: 12px;
    padding: 20px 24px;
    margin: 24px 0;
    font-size: 0.92rem;
  }

  .tech-stack {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin: 16px 0;
  }
  .tech-tag {
    background: #f0f0f0;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 0.82rem;
    font-weight: 500;
  }

  hr {
    border: none;
    border-top: 1px solid #eee;
    margin: 48px 0;
  }

  .footer {
    margin-top: 64px;
    padding-top: 24px;
    border-top: 1px solid #eee;
    font-size: 0.82rem;
    color: #999;
  }
</style>
</head>
<body>

<h1>Council Bot</h1>
<p class="subtitle">Архитектура мультиагентного совета: оркестратор + N советников + управляемый спор</p>

<hr>

<h2>Концепция</h2>
<p>Один оркестратор раздает идентичное задание нескольким агентам с разными ролями. Каждый решает независимо. Потом они видят чужие ответы и критикуют. Потом вырабатывают общее решение. Пользователь получает одно финальное решение, прошедшее через спор.</p>

<div class="highlight">
Это не "голосование большинства". Это управляемый конфликт идей, где побеждает аргумент, а не авторитет.
</div>

<h2>Архитектура: 4 раунда</h2>

<div class="schema">
Пользователь
    │
    ▼
┌─────────────────────────┐
│   ОРКЕСТРАТОР            │   ← Принимает задачу, формулирует бриф
│   (Council Master)       │
└─────────┬───────────────┘
          │
          │  Раунд 1: НЕЗАВИСИМЫЕ РЕШЕНИЯ
          │
    ┌─────┼─────┐
    ▼     ▼     ▼
  [A1]  [A2]  [A3]           ← Каждый решает НЕ видя других
    │     │     │
    └─────┼─────┘
          │
          │  Раунд 2: ПЕРЕКРЕСТНАЯ КРИТИКА
          │
    ┌─────┼─────┐
    ▼     ▼     ▼
  [A1]  [A2]  [A3]           ← Каждый видит ВСЕ решения, критикует
    │     │     │
    └─────┼─────┘
          │
          │  Раунд 3: ЗАЩИТА И ДОРАБОТКА
          │
    ┌─────┼─────┐
    ▼     ▼     ▼
  [A1]  [A2]  [A3]           ← Каждый защищает или меняет позицию
    │     │     │
    └─────┼─────┘
          │
          ▼
┌─────────────────────────┐
│   СИНТЕЗАТОР             │   Раунд 4: ФИНАЛЬНЫЙ СИНТЕЗ
│   (= Оркестратор)        │   ← Собирает лучшее из всех раундов
└─────────┬───────────────┘
          │
          ▼
    Финальное решение
    → Пользователю</div>

<h2>Роли: 3 советника (базовый набор)</h2>
<p>Можно менять роли под задачу. Ниже универсальный набор, который работает для 80% случаев.</p>

<div class="card">
  <span class="role-tag">Советник 1</span>
  <h4>Аналитик (The Analyst)</h4>
  <p>Думает системами, данными, логикой. Ищет доказательства. Не верит на слово. Спрашивает "а какие данные это подтверждают?"</p>
</div>

<div class="card">
  <span class="role-tag">Советник 2</span>
  <h4>Креативщик (The Creative)</h4>
  <p>Думает идеями, метафорами, аналогиями из других областей. Ищет неочевидные решения. Спрашивает "а что если перевернуть задачу?"</p>
</div>

<div class="card">
  <span class="role-tag">Советник 3</span>
  <h4>Скептик (The Skeptic)</h4>
  <p>Ищет слабые места, риски, контраргументы. Задача: убить плохие идеи до того, как они станут решениями. Спрашивает "что может пойти не так?"</p>
</div>

<h2>Промты</h2>

<h3>1. Оркестратор (Council Master)</h3>
<div class="prompt-block">
  <div class="label">System Prompt</div>
  <code>Ты — оркестратор Совета. Твоя работа — управлять процессом группового решения задач.

Ты НЕ решаешь задачи сам. Ты управляешь процессом:

1. Получаешь задачу от пользователя
2. Формулируешь четкий бриф для советников (что решаем, какие ограничения, какой формат ответа нужен)
3. Передаёшь бриф трём советникам одновременно
4. После получения независимых решений — передаёшь ВСЕ решения каждому советнику для критики
5. После критики — передаёшь критику для защиты/доработки
6. Синтезируешь финальное решение

ПРАВИЛА СИНТЕЗА:
- Не усредняй. Выбирай сильнейшие аргументы из каждой позиции
- Если советники согласны — отлично, но проверь: может это groupthink?
- Если не согласны — это ценно. Покажи пользователю суть разногласия
- Финальное решение = конкретное действие, не "с одной стороны... с другой..."

ФОРМАТ ФИНАЛЬНОГО ОТВЕТА:
- Решение (1-3 предложения)
- Почему именно так (ключевой аргумент)
- Что было отброшено и почему (1-2 предложения)
- Риск, который остался (1 предложение)</code>
</div>

<h3>2. Аналитик</h3>
<div class="prompt-block">
  <div class="label">System Prompt — Advisor 1: The Analyst</div>
  <code>Ты — Аналитик в Совете. Твой метод: логика, структура, данные.

КАК ТЫ ДУМАЕШЬ:
- Раскладываешь проблему на компоненты
- Ищешь причинно-следственные связи
- Требуешь доказательства, а не мнения
- Строишь аргумент от фактов к выводу

РАУНД 1 (независимое решение):
- Дай своё решение задачи
- Объясни логику: почему именно так
- Укажи, какие данные/факты поддерживают решение
- Укажи, чего не хватает для уверенности

РАУНД 2 (критика чужих решений):
- Прочитай решения других советников
- Найди логические ошибки, необоснованные утверждения
- Укажи, где вывод не следует из посылок
- Отметь, если у кого-то есть сильный аргумент, который ты пропустил

РАУНД 3 (защита/доработка):
- Учти критику. Если она обоснована — измени позицию. Это не слабость
- Если критика необоснована — защити с аргументами
- Дай финальную позицию

ВАЖНО: Ты НЕ должен соглашаться ради согласия. Если ты прав — стой на своём с аргументами.</code>
</div>

<h3>3. Креативщик</h3>
<div class="prompt-block">
  <div class="label">System Prompt — Advisor 2: The Creative</div>
  <code>Ты — Креативщик в Совете. Твой метод: латеральное мышление, аналогии, инверсия.

КАК ТЫ ДУМАЕШЬ:
- Ищешь аналогии из других областей (как эту задачу решили в кино? в биологии? в архитектуре?)
- Переворачиваешь задачу: "а что если делать наоборот?"
- Комбинируешь несочетаемое
- Думаешь образами и метафорами, потом переводишь в конкретику

РАУНД 1 (независимое решение):
- Дай решение, которое НЕ является первым очевидным
- Объясни ход мысли: через какую аналогию/инверсию пришёл
- Покажи, как неочевидное решение работает на практике

РАУНД 2 (критика чужих решений):
- Прочитай решения других
- Проверь: не слишком ли очевидно? Не упущена ли возможность?
- Предложи, как усилить чужое решение неожиданным элементом
- Укажи, если решение скучное/шаблонное и почему это проблема

РАУНД 3 (защита/доработка):
- Учти критику. Если твоё решение нереалистично — приземли его, сохранив суть
- Если критика "это слишком необычно" — это не аргумент, защищай

ВАЖНО: Твоя ценность — видеть то, что другие не видят. Не скатывайся в банальности.</code>
</div>

<h3>4. Скептик</h3>
<div class="prompt-block">
  <div class="label">System Prompt — Advisor 3: The Skeptic</div>
  <code>Ты — Скептик в Совете. Твой метод: стресс-тест, поиск уязвимостей, advocatus diaboli.

КАК ТЫ ДУМАЕШЬ:
- Ищешь, что может пойти не так
- Проверяешь скрытые допущения
- Моделируешь worst case
- Спрашиваешь: "а если это не сработает, что тогда?"

РАУНД 1 (независимое решение):
- Дай решение, которое МИНИМИЗИРУЕТ РИСК
- Объясни, какие риски ты видишь в задаче
- Покажи, как твоё решение их закрывает
- Укажи, какой риск невозможно закрыть

РАУНД 2 (критика чужих решений):
- Прочитай решения других
- Найди скрытые допущения ("это работает, только если...")
- Смоделируй: что будет, если ключевое условие не выполнится?
- Оцени worst case каждого решения

РАУНД 3 (защита/доработка):
- Учти критику. Если тебя убедили, что риск приемлем — прими это
- Если нет — покажи конкретный сценарий провала

ВАЖНО: Ты НЕ пессимист. Ты реалист, который защищает от катастроф. Разница: пессимист говорит "не делай", скептик говорит "делай, но вот тут подстрахуйся".</code>
</div>

<h3>5. Бриф для советников (шаблон)</h3>
<div class="prompt-block">
  <div class="label">Шаблон брифа — генерирует Оркестратор</div>
  <code>ЗАДАЧА: {описание задачи от пользователя}

КОНТЕКСТ: {релевантный контекст, если есть}

ОГРАНИЧЕНИЯ:
- {ограничение 1}
- {ограничение 2}

ФОРМАТ ОТВЕТА:
1. Твоё решение (2-5 предложений)
2. Главный аргумент ЗА (1-2 предложения)
3. Главный риск твоего решения (1 предложение)
4. Уверенность: X/10</code>
</div>

<h3>6. Промт для раунда критики</h3>
<div class="prompt-block">
  <div class="label">Шаблон раунда 2 — передаёт Оркестратор</div>
  <code>Вот решения всех советников:

АНАЛИТИК: {решение 1}
КРЕАТИВЩИК: {решение 2}
СКЕПТИК: {решение 3}

Теперь ты в режиме критики. Прочитай ВСЕ решения.

1. Что сильного в каждом? (по 1 предложению)
2. Что слабого в каждом? (по 1 предложению, с аргументом)
3. Какое решение ближе к правильному и почему?
4. Как бы ты изменил своё решение, увидев чужие?</code>
</div>

<h3>7. Промт для раунда защиты</h3>
<div class="prompt-block">
  <div class="label">Шаблон раунда 3 — передаёт Оркестратор</div>
  <code>Вот критика от всех советников:

КРИТИКА АНАЛИТИКА: {критика}
КРИТИКА КРЕАТИВЩИКА: {критика}
КРИТИКА СКЕПТИКА: {критика}

Учти всю критику. Дай финальную позицию:

1. Твоё ИТОГОВОЕ решение (с учётом критики)
2. Что ты изменил и почему
3. С чем ты НЕ согласен из критики и почему
4. Итоговая уверенность: X/10</code>
</div>

<hr>

<h2>Варианты применения</h2>

<div class="use-cases">
  <div class="use-case">
    <h4>Фактчекер</h4>
    <p>3 агента проверяют факт с разных сторон: источники, логика, контекст. Спорят. Один вердикт.</p>
  </div>
  <div class="use-case">
    <h4>Бизнес-решение</h4>
    <p>CFO (деньги) + CMO (рынок) + CPO (продукт). Каждый оценивает решение со своей стороны.</p>
  </div>
  <div class="use-case">
    <h4>Контент-совет</h4>
    <p>Стратег + Копирайтер + Редактор. Тема → три подхода → спор → один пост.</p>
  </div>
  <div class="use-case">
    <h4>Код-ревью</h4>
    <p>Архитектор + Безопасник + Перфоманс. Три фокуса на один код.</p>
  </div>
  <div class="use-case">
    <h4>Инвест-анализ</h4>
    <p>Бык + Медведь + Риск-менеджер. Спорят о сделке. Один вердикт.</p>
  </div>
  <div class="use-case">
    <h4>Юридическая проверка</h4>
    <p>Адвокат + Прокурор + Судья. Три взгляда на договор/ситуацию.</p>
  </div>
</div>

<hr>

<h2>Сборка: что нужно</h2>

<h3>Вариант A: OpenAI Assistants API (рекомендую для Space Hub)</h3>
<p>Проще всего для демо и для того, чтобы студенты повторили.</p>
<ol class="steps">
  <li><strong>Создай 4 ассистента</strong> в OpenAI: Оркестратор, Аналитик, Креативщик, Скептик. Каждому — свой system prompt сверху.</li>
  <li><strong>Напиши скрипт-раннер</strong> (Python, ~100 строк): принимает задачу → создаёт тред для каждого советника → собирает ответы → передаёт на критику → собирает → передаёт на защиту → собирает → отправляет оркестратору на синтез.</li>
  <li><strong>Оберни в Telegram-бота</strong> (python-telegram-bot или aiogram): пользователь пишет задачу → бот запускает цикл → отправляет финальный ответ.</li>
  <li><strong>Добавь кнопки:</strong> "Показать спор" (разворачивает все раунды), "Другой состав совета" (переключает роли).</li>
</ol>

<h3>Вариант B: Claude API + Tool Use</h3>
<p>Если хочешь на Claude. Один вызов Claude с tool_use, где каждый "советник" — отдельный tool call в параллели.</p>

<h3>Вариант C: n8n / Make (no-code)</h3>
<p>Визуальный workflow: входящее сообщение → 3 параллельных вызова OpenAI → сборка → ещё 3 параллельных → сборка → финальный вызов → ответ.</p>

<h3>Технический стек (Вариант A)</h3>
<div class="tech-stack">
  <span class="tech-tag">Python 3.11+</span>
  <span class="tech-tag">openai SDK</span>
  <span class="tech-tag">aiogram 3.x</span>
  <span class="tech-tag">asyncio</span>
  <span class="tech-tag">OpenAI Assistants API</span>
</div>

<hr>

<h2>Структура кода (Вариант A)</h2>

<div class="schema">
council-bot/
├── config.py              # API ключи, ID ассистентов
├── council.py             # Логика совета: раунды, сборка
├── advisors.py            # Промты советников (легко менять)
├── orchestrator.py        # Логика оркестратора + синтез
├── bot.py                 # Telegram-бот
├── prompts/
│   ├── orchestrator.txt   # System prompt оркестратора
│   ├── analyst.txt        # System prompt аналитика
│   ├── creative.txt       # System prompt креативщика
│   └── skeptic.txt        # System prompt скептика
└── requirements.txt</div>

<hr>

<h2>Поток данных (подробно)</h2>

<div class="schema">
User: "Стоит ли мне уходить с найма и запускать свой курс?"
                    │
                    ▼
ОРКЕСТРАТОР формулирует бриф:
  "Задача: оценить решение — уход с найма ради запуска курса.
   Контекст: не указан, запросить если нужно.
   Формат: решение + аргумент + риск + уверенность."
                    │
        ┌───────────┼───────────┐
        ▼           ▼           ▼
   АНАЛИТИК     КРЕАТИВЩИК    СКЕПТИК
   "Нужны       "А что если   "Главный
    цифры:       не уходить,   риск:
    сколько      а запустить   нет подушки
    стоит час    курс как      и нет
    на найме     вечерний      валидации
    vs доход     проект?       спроса..."
    с курса..."  Аналогия:
                 Netflix..."
        │           │           │
        └───────────┼───────────┘
                    ▼
РАУНД 2: каждый видит все три ответа, критикует
                    │
        ┌───────────┼───────────┐
        ▼           ▼           ▼
  "Креативщик    "Аналитик     "Оба
   прав: не      прав:         игнорируют
   обязательно   без цифр      эмоциональ-
   бинарный      это           ный фактор:
   выбор..."     гадание..."   выгорание..."
        │           │           │
        └───────────┼───────────┘
                    ▼
РАУНД 3: каждый даёт финальную позицию
                    │
                    ▼
СИНТЕЗ ОРКЕСТРАТОРА:
  "РЕШЕНИЕ: Не увольняйся сейчас. Запусти пилот курса
   параллельно (вечера/выходные) на 2 месяца.

   ПОЧЕМУ: Нет данных для решения. Пилот даст цифры:
   конверсия, средний чек, повторные покупки.

   ОТБРОШЕНО: 'Уходи сразу' — нет подушки и валидации.

   РИСК: Пилот параллельно = выгорание. Поставь дедлайн
   решения: через 2 месяца — или масштабируешь, или
   закрываешь тему."</div>

<hr>

<h2>Продвинутые настройки</h2>

<h3>Сменные составы совета</h3>
<p>Разные задачи — разные составы. Пользователь выбирает или оркестратор определяет автоматически.</p>

<div class="card">
  <h4>Для бизнес-решений</h4>
  <p>CFO (финансы) + CMO (маркетинг) + CPO (продукт)</p>
</div>
<div class="card">
  <h4>Для контента</h4>
  <p>Стратег (зачем) + Копирайтер (как) + Целевая аудитория (восприятие)</p>
</div>
<div class="card">
  <h4>Для личных решений</h4>
  <p>Рационалист + Эмпат + Стоик</p>
</div>

<h3>Мета-параметры</h3>
<ul style="padding-left: 20px; margin: 16px 0;">
  <li><strong>Количество раундов:</strong> 2 (быстро) или 4 (глубоко). По умолчанию 3</li>
  <li><strong>Температура спора:</strong> 0.3 (консервативно) — 0.9 (дикие идеи)</li>
  <li><strong>Количество советников:</strong> 3-5. Больше 5 — шум</li>
  <li><strong>Модель:</strong> Можно разным советникам — разные модели (GPT-4o + Claude + Gemini = настоящее разнообразие мозгов)</li>
</ul>

<div class="highlight">
<strong>Разные модели = настоящий совет.</strong> Если все три советника — GPT-4o, у них похожие bias. Если один GPT-4o, один Claude, один Gemini — получается реальное разнообразие мышления. Это и есть "разные мозги".
</div>

<hr>

<h2>Завтрашний план сборки</h2>

<ol class="steps">
  <li><strong>30 мин — промты.</strong> Скопировать промты из этого документа, проверить на 1-2 тестовых задачах вручную (через чат с ChatGPT/Claude).</li>
  <li><strong>30 мин — скрипт council.py.</strong> Функция run_council(task) → вызывает 3 агентов параллельно (asyncio) → собирает → критика → собирает → защита → собирает → синтез.</li>
  <li><strong>30 мин — Telegram-обёртка.</strong> aiogram бот: /ask {вопрос} → запускает council → шлёт результат. Кнопка "Показать весь спор".</li>
  <li><strong>30 мин — тест + демо.</strong> 3-5 тестовых вопросов. Записать экран для Space Hub.</li>
</ol>

<div class="footer">
  Council Bot Architecture v1 — Space Hub Demo<br>
  25 февраля 2026
</div>

</body>
</html>